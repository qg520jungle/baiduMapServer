<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>百度地图拓展应用</title>
  <link rel="stylesheet" href="./plugin/bootstrap.css">
  <link href="./plugin/fileinput.css" media="all" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="./css/common.css">
  <script src="./js/jquery-1.11.3.js"></script>
  <script src="./plugin/fileinput.js" type="text/javascript"></script>
  <script src="./plugin/fileinput_locale_zh.js" type="text/javascript"></script>
  <script src="./plugin/bootstrap.min.js"></script>
  <script src="./js/source.js"></script>
  <script src="./js/common.js"></script>
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=Di1FAQVUbVY6FvD6RIS5OdXwzmD5SFsL"></script>
    <!-- 加载百度地图样式信息窗口 -->
    <script type="text/javascript" src="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.js"></script>
    <link rel="stylesheet" href="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.css" />
    <!-- 加载城市列表 -->
    <script type="text/javascript" src="http://api.map.baidu.com/library/CityList/1.2/src/CityList_min.js"></script>
</head>
<body>
  <div class="g-head">
      <div class="m-logo">
          <span class="s-logo">百度地图拓展应用</span>
      </div>
      <div class="m-nav">
        <div class="m-crb">
          <span class="s-title">批量地址上传</span>
        </div>
      </div>
  </div>
  <div class="g-body">
    <div class="m-main-box">
      <input id="xlsx-file" class="file" type="file" name="recfile" data-min-file-count="1">
      <div class="m-wrap">
        <span class="f-btn"><span class="u-btn btn-bd2 j-upload">预处理xlsx文件</span></span>
        <div class="u-msg-box j-upload-msg"></div>
      </div>
      <div class="m-wrap ">
        <p class="s-info">说明: 点击 <a href="###">选择文件</a> 按钮或拖拽 xlsx 文件到拖拽区域</p>
        <div class="f-ml20">
          <p class="s-info">提交所需处理的批量地址文件 <a href="/public/url/post/downMould" class="s-link">模板下载</a></p>
          <p class="s-info">xlsx 文件格式如下</p>
          <img src="./img/demo.png" alt="">
          <p class="s-info">若格式非法 将无法获得正确结果</p>
        </div>
      </div>
    </div>
    <div class="m-info">
      
    </div>
  </div>
  <div class="g-foot">
    <p class="s-foot">By <b>Jungle</b></p>
    <p class="s-foot">源码已上传至 
      <a href="https://github.com/qg520jungle/baiduMapServer.git" class="s-link" target="_blank">
        https://github.com/qg520jungle/baiduMapServer.git
      </a> 
    </p>
    <p class="s-foot">bothqia@126.com 若有 <b>疑问</b> 或 <b>建议</b> 可与作者联系 </p>
  </div>
  <script>
  //上传文件 插件
    $("#xlsx-file").fileinput({
        uploadUrl: '/public/url/post/uploadxlsx', // you must set a valid URL here else you will get an error
        language: 'zh',
        dropZoneTitle: '拖拽xlsx文件到这里',
        browseClass: "btn btn-bd2 btn-block",
        browseLabel: "选择文件",
        allowedFileExtensions : ['xlsx'],
        overwriteInitial: false,
        maxFileSize: 1000,
        maxFilesNum: 1,
        maxFileCount: 1,
        //allowedFileTypes: ['image', 'video', 'flash'],
        slugCallback: function(filename) {
            return filename.replace('(', '_').replace(']', '_');
        }
  }).on('fileloaded', function(event, file, previewId, index, reader) {
    console.log("fileloaded");

  });
  //xlsx --> js 文件
    $('.j-upload').on('click',function(){
      avoidReClick($('.j-upload'))
      avoidReClick($('.j-init'))
      $.ajax({
        url:'/public/url/post/manageSrc',
        type: 'POST',
        dataType: 'json',
        data: {},
        success: function(res){
          if(res.RESULT == 1){
            $('.j-upload-msg').html('xlsx 文件上传成功！')
            window.location.href= '/download.html'
          }else if(res.RESULT == 0){
            $('.j-upload-msg').html('upload error ~~~')
          }else{
            $('.j-upload-msg').html('code is error !!!')
          }
          resetClick($('.j-upload'))
          resetClick($('.j-init'))
        }
      })
      
    })
     
  </script>
</body>
</html>